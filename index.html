<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Confirmação de Presença</title>
  <style>
    body {
      text-align: center;
      font-family: Arial;
      padding-top: 50px;
    }
    input {
      margin: 10px;
      padding: 10px;
      width: 300px;
    }
    button {
      padding: 10px 20px;
    }
  </style>
</head>
<body>
  <h2>Confirmação de Presença</h2>

  <input type="text" id="busca" placeholder="Digite matrícula ou nome">
  <br>
  <button onclick="consultar()">Consultar</button>

  <div id="resultado"></div>

  <script>
    async function consultar() {
      const termo = document.getElementById('busca').value.trim();
      const res = await fetch(
        'https://script.google.com/macros/s/AKfycby0VNl8tw-Gok-5YtoflFScPhzj1wotGBd0gkVpgPXCqh4ZQxJIegOWzIQvUDBrsWryMw/exec?termo=' + encodeURIComponent(termo)
      );
      const dados = await res.json();

      const div = document.getElementById('resultado');
      div.innerHTML = '';

      if (!dados.encontrado) {
        div.innerHTML = '<p><strong>Cadastro não encontrado.</strong></p>';
        return;
      }

      div.innerHTML = `<p><strong>Nome:</strong> ${dados.nome}</p>`;

      if (!dados.permiteConfirmar) {
        div.innerHTML += '<p><strong>Confirmação disponível apenas em 29/07/2025 das 07:45 às 12:00.</strong></p>';
        return;
      }

      const btn = document.createElement('button');
      btn.innerText = 'Confirmar Presença';
      btn.onclick = async () => {
        const r = await fetch(
          'https://script.google.com/macros/s/AKfycby0VNl8tw-Gok-5YtoflFScPhzj1wotGBd0gkVpgPXCqh4ZQxJIegOWzIQvUDBrsWryMw/exec?termo=' + encodeURIComponent(termo) + '&confirmar=1'
        );
        const d = await r.json();
        div.innerHTML = d.confirmado
          ? '<p><strong>Presença confirmada com sucesso.</strong></p>'
          : '<p><strong>Erro ao confirmar presença.</strong></p>';
      };
      div.appendChild(btn);
    }
  </script>
</body>
</html>
